-- MANTER SÓ 2025
SELECT * FROM TBL_CONTROLE_RESULTADODISCAGEM_OLOS -- COMO SABER A DATA DO REGISTRO ?

WHILE 1=1
BEGIN
	IF (
			DATEPART(WEEKDAY, GETDATE()) BETWEEN 2 AND 6 -- segunda a sexta
			AND (
				DATEPART(HOUR, GETDATE()) >= 22
				OR DATEPART(HOUR, GETDATE()) < 6
			)
    	)
    
		BEGIN
			DELETE TOP (10000) A
			FROM TBL_CONTROLE_RESULTADODISCAGEM_OLOS AS A
			JOIN CAD_DEVF AS B ON A.CONTRATO_FIN = B.CONTRATO_FIN
			WHERE B.DTENTRADA_FIN < '2025-01-01 00:00:00.000'

			IF (@@ROWCOUNT <= 0)
			BEGIN
				BREAK;
			END
	END
    ELSE
    BEGIN
        BREAK; -- Sai do loop se não estiver no horário/dia permitido
    END
END


-- EXCLUIR 2019 PRA TRAS
select MIN(DATA_EVENTO) from EVENTO_IMPORTACAO WHERE DATA_EVENTO < '2020-01-01 00:00:00.000' -- NÃO TEM NADA ANTES DE 2020, MENOR DATA É 2020-01-02 08:38:48.753
select COUNT(*) from ACIONA_AntesDaParada_20210208  WHERE DATA_ACIONA < '2020-01-01 00:00:00.000' -- TEM 1.428.959.498
select MIN(DATA_ACIONA) from ACIONA_VELHO2 WHERE DATA_ACIONA < '2020-01-01 00:00:00.000' -- NÃO TEM NADA ANTES DE 2020, MENOR DATA É 2021-11-01 09:18:06.797
select COUNT(*) from EVENTO WHERE DATA_EVENTO < '2020-01-01 00:00:00.000' -- TEM 569.210.993
select MIN(DATA_EXPURGO) from PS_ITAU_PARECER_EXPURGO WHERE DATA_EXPURGO < '2020-01-01 00:00:00.000' -- NÃO TEM NADA ANTES DE 2020, MENOR DATA É 2021-08-28 20:00:00.873
select * from TAB_IDLIGACAODISCADOR_ACIONA_antes_parada_21210208 -- NÃO TEM DADOS


-- NÃO TEM NADA ANTES DE 2020, MENOR DATA É 2020-01-02 08:38:48.753
WHILE 1=1
BEGIN
	IF (
			DATEPART(WEEKDAY, GETDATE()) BETWEEN 2 AND 6 -- segunda a sexta
			AND (
				DATEPART(HOUR, GETDATE()) >= 22
				OR DATEPART(HOUR, GETDATE()) < 6
			)
    	)
	BEGIN
		DELETE TOP (10000)
		FROM EVENTO_IMPORTACAO
		WHERE DATA_EVENTO < '2020-01-01 00:00:00.000'

		IF (@@ROWCOUNT <= 0)
		BEGIN
			BREAK;
		END
	END ELSE
    BEGIN
        BREAK; -- Sai do loop se não estiver no horário/dia permitido
    END
END

-- TEM 1.428.959.498
WHILE 1=1
BEGIN
	IF (
			DATEPART(WEEKDAY, GETDATE()) BETWEEN 2 AND 6 -- segunda a sexta
			AND (
				DATEPART(HOUR, GETDATE()) >= 22
				OR DATEPART(HOUR, GETDATE()) < 6
			)
    	)
	BEGIN
		DELETE TOP (10000)
		FROM ACIONA_AntesDaParada_20210208
		WHERE DATA_ACIONA < '2020-01-01 00:00:00.000'

		IF (@@ROWCOUNT <= 0)
		BEGIN
			BREAK;
		END
	END ELSE
    BEGIN
        BREAK; -- Sai do loop se não estiver no horário/dia permitido
    END
END

-- NÃO TEM NADA ANTES DE 2020, MENOR DATA É 2021-11-01 09:18:06.797
WHILE 1=1
BEGIN
	IF (
			DATEPART(WEEKDAY, GETDATE()) BETWEEN 2 AND 6 -- segunda a sexta
			AND (
				DATEPART(HOUR, GETDATE()) >= 22
				OR DATEPART(HOUR, GETDATE()) < 6
			)
    	)
	BEGIN
		DELETE TOP (10000)
		FROM ACIONA_VELHO2
		WHERE DATA_ACIONA < '2020-01-01 00:00:00.000'

		IF (@@ROWCOUNT <= 0)
		BEGIN
			BREAK;
		END
	END ELSE
    BEGIN
        BREAK; -- Sai do loop se não estiver no horário/dia permitido
    END
END

-- TEM 569.210.993
WHILE 1=1
BEGIN
	IF (
			DATEPART(WEEKDAY, GETDATE()) BETWEEN 2 AND 6 -- segunda a sexta
			AND (
				DATEPART(HOUR, GETDATE()) >= 22
				OR DATEPART(HOUR, GETDATE()) < 6
			)
    	)
	BEGIN
		DELETE TOP (10000)
		FROM EVENTO
		WHERE DATA_EVENTO < '2020-01-01 00:00:00.000'

		IF (@@ROWCOUNT <= 0)
		BEGIN
			BREAK;
		END
	END ELSE
    BEGIN
        BREAK; -- Sai do loop se não estiver no horário/dia permitido
    END
END

-- NÃO TEM NADA ANTES DE 2020, MENOR DATA É 2021-08-28 20:00:00.873
WHILE 1=1
BEGIN
	IF (
			DATEPART(WEEKDAY, GETDATE()) BETWEEN 2 AND 6 -- segunda a sexta
			AND (
				DATEPART(HOUR, GETDATE()) >= 22
				OR DATEPART(HOUR, GETDATE()) < 6
			)
    	)
	BEGIN
		DELETE TOP (10000)
		FROM PS_ITAU_PARECER_EXPURGO
		WHERE DATA_EXPURGO < '2020-01-01 00:00:00.000'

		IF (@@ROWCOUNT <= 0)
		BEGIN
			BREAK;
		END
	END ELSE
    BEGIN
        BREAK; -- Sai do loop se não estiver no horário/dia permitido
    END
END

-- NÃO TEM DADOS E A TABELA TA COM O CAMPO DE DATA COMO VARCHAR
WHILE 1=1
BEGIN
	IF (
			DATEPART(WEEKDAY, GETDATE()) BETWEEN 2 AND 6 -- segunda a sexta
			AND (
				DATEPART(HOUR, GETDATE()) >= 22
				OR DATEPART(HOUR, GETDATE()) < 6
			)
    	)
	BEGIN
		DELETE TOP (10000)
		FROM TAB_IDLIGACAODISCADOR_ACIONA_antes_parada_21210208
		WHERE CAST(DATA_CONTRATO AS DATETIME) < '2020-01-01 00:00:00.000'

		IF (@@ROWCOUNT <= 0)
		BEGIN
			BREAK;
		END
	END ELSE
    BEGIN
        BREAK; -- Sai do loop se não estiver no horário/dia permitido
    END
END